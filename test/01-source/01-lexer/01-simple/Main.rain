
fact  Coin   [issuer: Party,  holder:   Party]
fact  Offer  [id:     Symbol, terms:    Text,
              giver:  Party,  receiver: Party]
fact  Accept [id:     Symbol, accepter: Party]


rule  transfer
await Offer  [id = ?i, giver = ?g, receiver = ?r] gain {g}
  and Accept [id = i,  accepter = r]              gain {r}
  and Coin   [issuer = !Isabelle,  holder = g]    gain {!Isabelle,g}
to
  say Coin   [issuer = !Isabelle,  holder = r]
   by {!Isabelle,r} use {'transfer}


scenario test to
 add    say Coin [issuer = !Isabelle, holder = !Alice]
        by  {!Isabelle, !Alice}
        use {'transfer} num 100

 add    say Offer  [ id = '1234
                   , giver = !Alice, receiver = !Bob]
        by {!Alice} obs {!Bob} use {'transfer}

 add    say Accept [id = '1234, accepter = !Bob]
        by {!Bob}   obs {!Alice} use {'transfer}

 dump
 fire   by {!Alice} rules {'transfer}


